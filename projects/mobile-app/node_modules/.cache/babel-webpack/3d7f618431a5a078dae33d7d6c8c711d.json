{"ast":null,"code":"import _asyncToGenerator from \"/Users/avsv/Documents/GitHub/atlas-workspace/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { NavigationStart } from \"@angular/router\";\nimport { filter } from \"rxjs/operators\";\nimport { App } from '@capacitor/app';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"@angular/router\";\nexport class BackButtonService {\n  constructor(navCtrl, platform, router, toastController) {\n    this.navCtrl = navCtrl;\n    this.platform = platform;\n    this.router = router;\n    this.toastController = toastController;\n    this.rootSubscription = undefined;\n    this.actionSubscription = undefined;\n    this.backCounter = 0;\n    this.routeCounter = 0;\n    this.rootPages = ['tabs-notifications', 'tabs-offline', 'tabs-progress', 'tabs-about', 'tabs-tests', 'tabs'];\n    this.router.events.pipe(filter(event => event instanceof NavigationStart)).subscribe(x => {\n      if (!this.routeCounter) {\n        this.routeCounter++;\n        return;\n      }\n\n      if (this.isRootPage(x.url)) {\n        this.disableBackOnRoot(this.platform);\n      } else {\n        this.clearOnRoot();\n        this.default(this.platform);\n      }\n    });\n  }\n\n  init(platform) {\n    this.disableBackOnRoot(platform);\n  }\n\n  default(platform) {\n    platform.backButton.subscribeWithPriority(9999, () => {\n      this.navCtrl.back();\n    });\n  }\n\n  actionOnBack(platform, action, isBack = true) {\n    this.rootSubscription = platform.backButton.subscribeWithPriority(9999, () => {\n      action();\n\n      if (isBack) {\n        this.navCtrl.back();\n      }\n    });\n  }\n\n  disableBackOnRoot(platform) {\n    this.rootSubscription = platform.backButton.subscribeWithPriority(9999, () => {\n      this.backCounter++;\n\n      if (this.backCounter === 2) {\n        App.exitApp();\n      } else {\n        this.showBackElseMessage().then();\n        setTimeout(() => this.backCounter = 0, 1500);\n      }\n    });\n  }\n\n  clearOnRoot() {\n    var _a;\n\n    if (!this.rootSubscription) {\n      return;\n    }\n\n    (_a = this.rootSubscription) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n    this.rootSubscription = undefined;\n  }\n\n  clearAction() {\n    var _a;\n\n    if (!this.actionSubscription) {\n      return;\n    }\n\n    (_a = this.actionSubscription) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n    this.actionSubscription = undefined;\n  }\n\n  showBackElseMessage() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      const toast = yield _this.toastController.create({\n        message: 'Для выхода из приложения нажмите \"Назад\" еще раз',\n        duration: 1500,\n        cssClass: 'custom-toast'\n      });\n      yield toast.present();\n    })();\n  }\n\n  isRootPage(path) {\n    const checkPath = path.split('/').slice(-1)[0];\n\n    for (let page of this.rootPages) {\n      if (checkPath === page) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n}\n\nBackButtonService.ɵfac = function BackButtonService_Factory(t) {\n  return new (t || BackButtonService)(i0.ɵɵinject(i1.NavController), i0.ɵɵinject(i1.Platform), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i1.ToastController));\n};\n\nBackButtonService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: BackButtonService,\n  factory: BackButtonService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["/Users/avsv/Documents/GitHub/atlas-workspace/projects/mobile-app/src/app/core/services/platform/back-button.service.ts"],"names":["NavigationStart","filter","App","i0","i1","i2","BackButtonService","constructor","navCtrl","platform","router","toastController","rootSubscription","undefined","actionSubscription","backCounter","routeCounter","rootPages","events","pipe","event","subscribe","x","isRootPage","url","disableBackOnRoot","clearOnRoot","default","init","backButton","subscribeWithPriority","back","actionOnBack","action","isBack","exitApp","showBackElseMessage","then","setTimeout","_a","unsubscribe","clearAction","toast","create","message","duration","cssClass","present","path","checkPath","split","slice","page","ɵfac","BackButtonService_Factory","t","ɵɵinject","NavController","Platform","Router","ToastController","ɵprov","ɵɵdefineInjectable","token","factory","providedIn"],"mappings":"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","sourcesContent":["import { NavigationStart } from \"@angular/router\";\nimport { filter } from \"rxjs/operators\";\nimport { App } from '@capacitor/app';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"@angular/router\";\nexport class BackButtonService {\n    constructor(navCtrl, platform, router, toastController) {\n        this.navCtrl = navCtrl;\n        this.platform = platform;\n        this.router = router;\n        this.toastController = toastController;\n        this.rootSubscription = undefined;\n        this.actionSubscription = undefined;\n        this.backCounter = 0;\n        this.routeCounter = 0;\n        this.rootPages = [\n            'tabs-notifications',\n            'tabs-offline',\n            'tabs-progress',\n            'tabs-about',\n            'tabs-tests',\n            'tabs',\n        ];\n        this.router.events\n            .pipe(filter(event => event instanceof NavigationStart))\n            .subscribe((x) => {\n            if (!this.routeCounter) {\n                this.routeCounter++;\n                return;\n            }\n            if (this.isRootPage(x.url)) {\n                this.disableBackOnRoot(this.platform);\n            }\n            else {\n                this.clearOnRoot();\n                this.default(this.platform);\n            }\n        });\n    }\n    init(platform) {\n        this.disableBackOnRoot(platform);\n    }\n    default(platform) {\n        platform.backButton.subscribeWithPriority(9999, () => {\n            this.navCtrl.back();\n        });\n    }\n    actionOnBack(platform, action, isBack = true) {\n        this.rootSubscription = platform.backButton.subscribeWithPriority(9999, () => {\n            action();\n            if (isBack) {\n                this.navCtrl.back();\n            }\n        });\n    }\n    disableBackOnRoot(platform) {\n        this.rootSubscription = platform.backButton.subscribeWithPriority(9999, () => {\n            this.backCounter++;\n            if (this.backCounter === 2) {\n                App.exitApp();\n            }\n            else {\n                this.showBackElseMessage().then();\n                setTimeout(() => this.backCounter = 0, 1500);\n            }\n        });\n    }\n    clearOnRoot() {\n        var _a;\n        if (!this.rootSubscription) {\n            return;\n        }\n        (_a = this.rootSubscription) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n        this.rootSubscription = undefined;\n    }\n    clearAction() {\n        var _a;\n        if (!this.actionSubscription) {\n            return;\n        }\n        (_a = this.actionSubscription) === null || _a === void 0 ? void 0 : _a.unsubscribe();\n        this.actionSubscription = undefined;\n    }\n    async showBackElseMessage() {\n        const toast = await this.toastController.create({\n            message: 'Для выхода из приложения нажмите \"Назад\" еще раз',\n            duration: 1500,\n            cssClass: 'custom-toast',\n        });\n        await toast.present();\n    }\n    isRootPage(path) {\n        const checkPath = path.split('/').slice(-1)[0];\n        for (let page of this.rootPages) {\n            if (checkPath === page) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\nBackButtonService.ɵfac = function BackButtonService_Factory(t) { return new (t || BackButtonService)(i0.ɵɵinject(i1.NavController), i0.ɵɵinject(i1.Platform), i0.ɵɵinject(i2.Router), i0.ɵɵinject(i1.ToastController)); };\nBackButtonService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: BackButtonService, factory: BackButtonService.ɵfac, providedIn: 'root' });\n"]},"metadata":{},"sourceType":"module"}